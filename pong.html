<head>
	<title>Pong</title>
</head>
<body style="background-color:black;">
<canvas id="gameCanvas" style="width:100%;height:100%;margin:0px;padding:0px;">The canvas tag is not supported :-(</canvas>
</body>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const foregroundColor = "white";
const backgroundColor = "black";
let playerSpeed = 20;
let ballSpeed = 5;
let playerOneY;
let playerTwoY;
let ballX;
let ballY;
let ballDir;
let playerOneScore = 0;
let playerTwoScore = 0;
let updateGame;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;



function newRound(){
	playerOneY = window.innerHeight / 2;
	playerTwoY = window.innerHeight / 2;
	ballX = window.innerWidth / 2;
	ballY = window.innerHeight / 2;
	ballDir = Math.floor(Math.random() * 360);
	

}

function clearCanvas(){
	ctx.fillStyle = backgroundColor;
	ctx.fillRect(0,0,canvas.width,canvas.height);
	ctx.fillStyle = foregroundColor;
}

function drawPlayers(){
	
	
	
	ctx.fillRect(0,playerOneY,50,200); // player1
	ctx.fillRect(canvas.width - 50,playerTwoY,50,200); // player2
}

function drawBall(){
	
	
	ctx.fillRect(ballX,ballY,20,20);
}

newRound();

addEventListener("keydown", (event) => {
	
	// TODO - when x > 0, only let player 2 move but when x < 0, only let player1 move
	
	if(ballX < canvas.width / 2){
	switch(event.key){
	case "w":
		playerOneY -= playerSpeed;
		break;
		
	
	case "s":
		playerOneY += playerSpeed;
		break;
	}
	}
	
	if(ballX > canvas.width / 2){
	switch(event.key){
	
	
	case "i":
		playerTwoY -= playerSpeed;
		break;
		
	
	case "k":
		playerTwoY += playerSpeed;
		break;
		
	}
	}
	
	
	
});



updateGame = setInterval(gameloop,10);


function updateBall(){
	drawBall();
	
	// ball position update
	
	ballX += (Math.sin(ballDir) * ballSpeed);
	ballY -= (Math.cos(ballDir) * ballSpeed);
	
	
}

function checkCollisions(){
	// ball
	
	if(ballX < canvas.width / 2 && ballY > playerOneY && ballY + 200 > ballY && ballX < 60){ // if touching player1
		ballDir += ballDir % 180;
	}
	
	if(ballX > canvas.width / 2 && ballY > playerTwoY && ballY + 200 > ballY && ballX > canvas.width - 60){ // if touching player2
		ballDir += ballDir % 180;
	}
	
	if(ballX < 1){
		playerTwoScore++;
		newRound();
	}
	if(ballX > canvas.width){
		playerOneScore++;
		newRound();
	}
	
	if(ballY < 0){
		ballDir += ballDir % 180;
	}
	
	if(ballY > canvas.height){
		ballDir += ballDir % 180;
	}
}

function drawScoreboard(){
	ctx.font = "48px Pixelify Sans";
	
	ctx.fillText(playerOneScore,10,50);
	ctx.fillText(playerTwoScore,canvas.width - 10 * toString(playerTwoScore).length,50)
}

function gameloop(){
	clearCanvas();
	
	drawPlayers();
	
	updateBall();
	
	drawScoreboard();
	
	checkCollisions();
}


</script>